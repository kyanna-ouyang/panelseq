# run in Bash

# CONFIGURATION
bsub -q verylong -n 24 -R "rusage[mem=50G]" 'while read i; do \

mkdir results_${i} \

STRELKA_INSTALL_PATH="/omics/groups/OE0554/internal/EMIL/Kyanna/strelka/strelka-2.9.10.centos6_x86_64" \

STRELKA_ANALYSIS_PATH="/omics/groups/OE0554/internal/EMIL/Toni/fuso/fastq/results_${i}" \

ref_fuso="/omics/groups/OE0554/internal/EMIL/Toni/fuso/sequence.fasta" \

normal_BAM="/omics/groups/OE0554/internal/EMIL/Toni/fuso/fastq/31.aln-pe.sorted.bam" \

test_BAM="/omics/groups/OE0554/internal/EMIL/Toni/fuso/fastq/${i}.aln-pe.sorted.bam" \

${STRELKA_INSTALL_PATH}/bin/configureStrelkaSomaticWorkflow.py \
--normalBam $normal_BAM \
--tumourBam $test_BAM \
--referenceFasta $ref_fuso \
--runDir $STRELKA_ANALYSIS_PATH \

done < /omics/groups/OE0554/internal/EMIL/Toni/fuso/ids.txt'

# EXECUTION
bsub -q verylong -n 24 -R "rusage[mem=50G]" "./runWorkflow.py -m local -j 8"

# unzip vcf files
while read i; do
	gunzip -c results_${i}/results/variants/somatic.indels.vcf.gz > results_${i}/results/variants/somatic.indels.vcf
	gunzip -c results_${i}/results/variants/somatic.snvs.vcf.gz > results_${i}/results/variants/somatic.snvs.vcf
done < samples.txt

# move all vcf files to one folder
while read i; do
	mv results_${i}/results/variants/somatic.indels.vcf results/${i}.somatic.indels.vcf
	mv results_${i}/results/variants/somatic.snvs.vcf results/${i}.somatic.snvs.vcf
done < samples.txt

# sync to local drive (rsync example; can also drag and drop using mounted cluster)
while read i; do
	rsync k545g@bsub01.lsf.dkfz.de:/omics/groups/OE0554/internal/EMIL/Kyanna/strelkatrial/results_${i}/results/variants/somatic.indels.vcf .
	rsync k545g@bsub01.lsf.dkfz.de:/omics/groups/OE0554/internal/EMIL/Kyanna/strelkatrial/results_${i}/results/variants/somatic.snvs.vcf .
	mv somatic.indels.vcf ${i}.somatic.indels.vcf
	mv somatic.snvs.vcf ${i}.somatic.snvs.vcf
done < samples.txt
